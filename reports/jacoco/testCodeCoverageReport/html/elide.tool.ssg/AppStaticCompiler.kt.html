<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>AppStaticCompiler.kt</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">reports</a> &gt; <a href="index.source.html" class="el_package">elide.tool.ssg</a> &gt; <span class="el_source">AppStaticCompiler.kt</span></div><h1>AppStaticCompiler.kt</h1><pre class="source lang-java linenums">package elide.tool.ssg

import kotlinx.coroutines.Deferred
import java.io.Closeable
import kotlin.jvm.Throws

/**
 * # SSG: Static Compiler
 *
 * This class is responsible for the actual business logic of compiling a static site from generated requests, based on
 * the app's metadata. Requests are generated by the [AppLoader] in cooperation with the [RequestFactory]; with requests
 * and configured endpoints in hand, this class kicks in to recursively fulfill the full tree of requests.
 *
 * ## URL discovery
 *
 * To account for static assets and other handlers which are not marked as page controllers, additional URLs may be
 * added statically or discovered at runtime based on the returned HTML, which is parsed to discover these assets. As
 * URLs are discovered and deemed eligible for compilation, they are added to the queue of requests to be fulfilled,
 * which enqueues a new tree of requests within this class.
 */
public interface AppStaticCompiler : Closeable, AutoCloseable {
  /**
   * Prepare the static site compiler with input [params] and interpreted [appInfo]; the compiler may also make use of
   * the provided [loader] to fire requests at the user's app.
   *
   * @param params Compiler parameters provided via the command line or via programmatic invocation.
   * @param appInfo Loaded application manifest and info.
   * @param loader App loader to use for firing requests.
   */
  public fun prepare(params: SiteCompilerParams, appInfo: LoadedAppInfo, loader: AppLoader)

  /**
   * Run the static site compiler with the provided expected [seed] inputs (of length [count]); if so directed via the
   * params passed to [prepare], the compiler will also attempt to discover additional URLs in returned HTML responses.
   *
   * This method will execute until all requests have been fulfilled, or until the compiler has been interrupted. A call
   * is considered &quot;fulfilled&quot; when the following conditions are true:
   *
   * 1) A response has been received from the application, or
   * 2) An error has been encountered while fulfilling the request, or
   * 3) The request timeout value elapsed (a subset of case 2).
   *
   * This method operates synchronously, via suspension. For asynchronous dispatch, see [compileStaticSiteAsync], which
   * this method calls into.
   *
   * @see compileStaticSiteAsync for asynchronous dispatch.
   * @param count Count of seed requests to begin the compilation with.
   * @param appInfo Loaded application manifest and info.
   * @param seed Expected requests which should be used to start the execution.
   * @param buffer Buffer which holds the results from each request/response cycle.
   * @return Compiler execution result.
   * @throws SSGCompilerError in the event of an unrecoverable error.
   */
  @Throws(SSGCompilerError::class)
<span class="fc" id="L55">  public suspend fun compileStaticSite(</span>
    count: Int,
    appInfo: LoadedAppInfo,
    seed: Sequence&lt;StaticFragmentSpec&gt;,
    buffer: StaticSiteBuffer,
<span class="fc" id="L60">  ): SiteCompileResult = compileStaticSiteAsync(</span>
<span class="fc" id="L61">    count,</span>
<span class="fc" id="L62">    appInfo,</span>
<span class="fc" id="L63">    seed,</span>
<span class="fc" id="L64">    buffer,</span>
<span class="fc" id="L65">  ).await()</span>

  /**
   * Run the static site compiler with the provided expected [seed] inputs (of length [count]); if so directed via the
   * params passed to [prepare], the compiler will also attempt to discover additional URLs in returned HTML responses.
   *
   * This method will execute until all requests have been fulfilled, or until the compiler has been interrupted. A call
   * is considered &quot;fulfilled&quot; when the following conditions are true:
   *
   * 1) A response has been received from the application, or
   * 2) An error has been encountered while fulfilling the request, or
   * 3) The request timeout value elapsed (a subset of case 2).
   *
   * This method operates asynchronously, by returning a [Deferred] job which evaluates to the compiler result. For
   * synchronous dispatch, see [compileStaticSite].
   *
   * @see compileStaticSite for synchronous dispatch.
   * @param count Count of seed requests to begin the compilation with.
   * @param appInfo Loaded application manifest and info.
   * @param seed Expected requests which should be used to start the execution.
   * @param buffer Buffer which holds the results from each request/response cycle.
   * @return Compiler execution result.
   * @throws SSGCompilerError in the event of an unrecoverable error.
   */
  public suspend fun compileStaticSiteAsync(
    count: Int,
    appInfo: LoadedAppInfo,
    seed: Sequence&lt;StaticFragmentSpec&gt;,
    buffer: StaticSiteBuffer,
  ): Deferred&lt;SiteCompileResult&gt;
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.8.202204050719</span></div></body></html>