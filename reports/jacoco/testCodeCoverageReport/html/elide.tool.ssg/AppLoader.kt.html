<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>AppLoader.kt</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">reports</a> &gt; <a href="index.source.html" class="el_package">elide.tool.ssg</a> &gt; <span class="el_source">AppLoader.kt</span></div><h1>AppLoader.kt</h1><pre class="source lang-java linenums">package elide.tool.ssg

import kotlinx.coroutines.Deferred
import tools.elide.meta.AppManifest
import java.io.Closeable
import java.net.URL
import kotlin.jvm.Throws

/**
 * # SSG: Application Runner
 *
 * This interface defines the API surface of an object charged with running an Elide application within the context of
 * an SSG compiler build. The app must be running while requests are executed against it; then, after request activity
 * has concluded, the app must safely be stopped and cleaned up.
 *
 * In CLI circumstances, the app will need to be run on the command line, either via a JAR or native executable. In
 * testing circumstances, the app can be run inline with requests directed within the test process.
 *
 * There is a special mode, &quot;HTTP mode,&quot; which, when active, directs the application runner to load against an external
 * HTTP URL instead of a JAR or native executable. In this mode, the `target` parameter passed on the command line, or
 * in the scope of a programmatic invocation, is expected to be an HTTP or HTTPS URL instead of a file system path.
 *
 * ## Target application expectations
 *
 * The target application is expected to be a well-formed Elide application, which extends Micronaut's same guarantees;
 * i.e. the app must be configurable via environment variables and system properties at runtime, so that the compiler
 * can assign a port and other configuration values to the app.
 *
 * ## HTTP mode
 *
 * When &quot;HTTP mode&quot; is active, the app loader will direct requests to an external URL, instead of loading classes from
 * a JAR. In this mode, the `target` parameter is expected to be a well-formed HTTP or HTTPS URL. Requests are executed
 * against the provided URL with the loaded app manifest.
 */
public interface AppLoader : Closeable, AutoCloseable {
  /**
   * Prepare to execute an application by loading the `jar` or HTTP target specified within the provided [params]; if
   * extra classpath entries are provided by invoking tooling, they can be considered here.
   *
   * This method operates synchronously. For asynchronous dispatch, see [prepAsync].
   *
   * @see prepAsync for asynchronous dispatch.
   * @param params Compiler parameters to consider.
   * @param app Loaded application manifest.
   * @return Loaded application info.
   * @throws SSGCompilerError if an error occurs while loading the application JAR.
   */
  @Throws(SSGCompilerError::class)
<span class="fc" id="L49">  public suspend fun prep(params: SiteCompilerParams, app: AppManifest): LoadedAppInfo = prepAsync(</span>
<span class="fc" id="L50">    params,</span>
<span class="fc" id="L51">    app,</span>
<span class="fc" id="L52">  ).await()</span>

  /**
   * Prepare to execute an application by loading the `target` from the provided [params] (if HTTP mode is inactive);
   * otherwise, parse the provided URL in HTTP mode.
   *
   * If extra classpath entries are provided by invoking tooling, they can be considered here. This method operates
   * asynchronously. For synchronous dispatch, see [prep]. The returned URL
   *
   * @see prep for synchronous dispatch.
   * @param params Compiler parameters to consider.
   * @param app Loaded application manifest.
   * @return Deferred job that completes with [LoadedAppInfo] and a [URL] when the JAR is loaded, or throws an error.
   * @throws SSGCompilerError if an error occurs while loading the application JAR.
   */
  public suspend fun prepAsync(params: SiteCompilerParams, app: AppManifest): Deferred&lt;LoadedAppInfo&gt;

  /**
   * Generate a set of seed requests against known application endpoints, based on the [AppManifest] provided to the
   * [prep] method; the provided [factory] should be used to generate each request.
   *
   * @param factory Factory to use to generate requests.
   * @return Set of seed requests, as an [Int] count paired with a [Sequence].
   */
  public suspend fun generateRequests(factory: RequestFactory): Pair&lt;Int, Sequence&lt;StaticFragmentSpec&gt;&gt;

  /**
   * Execute the provided [StaticFragmentSpec] against the currently-loaded application; prepare the result in a final
   * [StaticFragment] record and return it.
   *
   * If a response cannot be acquired from the user's application for whatever reason, `null` is returned, so that it
   * may hold place for error counts.
   *
   * @param spec Fragment specification to execute.
   * @return Finalized fragment, or `null` if a non-fatal error occurred.
   */
  public suspend fun executeRequest(spec: StaticFragmentSpec): StaticFragment?
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.8.202204050719</span></div></body></html>